p <- p + geom_line(size=0.5) + facet_grid(facteur ~ sex ~ age, labeller = label_both,scales = "free_y") #show.legend = FALSE
p
ggsave("sc_higherprop.pdf")
base <- "/home/reyman/TRASH/5ad/mars2022"
sortie_sc5_smallerProp <- concatFiles(base,"/statistics/SmallerProp")
sortie_sc5_smallerProp$propHealthy <- sortie_sc5_smallerProp$healthy / sortie_sc5_smallerProp$effective
sortieLong_sc5_sp <- gather(sortie_sc5_smallerProp, facteur, valeur,c(propHealthy,avgOpinion) )
sortieLong_sc5_sp <- mutate(sortieLong_sc5_sp, "ds" = gsub(" ", "", paste(paste("[",paste(sortieLong_sc5_sp$day, sortieLong_sc5_sp$slice)),"]")))
p <- ggplot(data=sortieLong_sc5_sp, aes(x=ds, y=valeur, group=educ, fill=educ, colour=as.character(educ)))
p <- p + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
p <- p + geom_line(size=0.5) + facet_grid(facteur ~ sex ~ age, labeller = label_both,scales = "free_y") #show.legend = FALSE
p
ggsave("sc_smallerprop.pdf")
library("httr")
r <- GET("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL")
r*
f
r
str(content(r))
str(content(r$download))
str(content(r$download))
str(content(r))
str(content(r$files))
str(content(r))
str(content(r, "parsed"))
str(content(r, "parsed")$files)
str(content(r, "parsed")$files$links$download)
str(content(r, "parsed")$files$links)
str(content(r, "parsed")$files)
str(content(r, "parsed")$files$links)
str(content(r, "parsed")$files)
str(content(r, "parsed")$files[2])
str(content(r, "parsed")$files)
str(content(r, "parsed")$files$checksum)
str(content(r, "parsed")$files)
content(r, "parsed")$files
content(r, "parsed")$files$links$download
content(r, "parsed")$files$links
content(r, "parsed")$files
content(r, "parsed")$files[[1]]
content(r, "parsed")$files[[1]]$links
content(r, "parsed")$files[[1]]$links$download
library("curl")
curl_download(download_url,tmp)
tmp <- tmpfile()
curl_download(download_url,tmp)
tmp <- tempfile()
curl_download(download_url,tmp)
download_url <- content(r, "parsed")$files[[1]]$links$download
curl_download(download_url,tmp)
print(download_url)
curl_download(download_url,tmp)
print(download_url)
tmp <- tempfile()
curl_download(download_url,tmp)
curl_fetch_disk(download_url,tmp)
r <- GET("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL")
download_url <- content(r, "parsed")$files[[1]]$links$download
print(download_url)
cookies(r)
GET("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL")
r <- GET("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL")
cookies(r)
x <- GET(download_url, cookies(r))
x <- GET(download_url)
x <- GET(download_url, write_disk(tmp,overwrite = TRUE))
dest <- paste0(getwd(), "valentine.zip")
x <- GET(download_url, write_disk(dest,overwrite = TRUE))
print(download_url)
r <- GET("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL")
print(r)
print(r$cookies)
r <- GET("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", verbose())
h <- new_handle()
r <- curl("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL",handle = h)
cookies(h)
h
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiefile=cookie_file)
r <- curl("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
r <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
download_url <- content(r, "parsed")$files[[1]]$links$download
print(r)
jsonlite::fromJSON(rawToChar(res$content))
r <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
jsonlite::fromJSON(rawToChar(res$content))
download_url <- jsonlite::fromJSON(rawToChar(res$content))
res <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- content(r_json, "parsed")$files[[1]]$links$download
download_url <- res_json$files[[1]]$links$download
res_json <- jsonlite::fromJSON(rawToChar(res$content))
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json$files[[1]]$links$download
View(res_json)
res_json <- httr::content(res$content)
res_json <- httr::content(res)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- httr::content(res)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
str(res_json)
download_url <- res_json$files[[1]]$links$download
download_url <- res_json[[1]]$files[[1]]$links$download
download_url <- res_json
download_url <- res_json[[1]]
download_url <- res_json[[1]]
download_url <- res_json[]$files[[1]]$links$download
download_url <- res_json[]
View(download_url)
download_url <- res_json[["files"]][["links"]][["download"]]
curl_download(download_url, handle = h)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, handle = h)
curl_download(download_url, tmp, handle = h)
curl_download(download_url, destfile = tmp, handle = h)
download_url <- res_json[["files"]][["links"]][["download"]]
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
download_url <- res_json[["files"]][["links"]][["download"]]
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = tmp)
handle_cookies(h)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
handle_cookies(h)
res <- GET(download_url, httr::config(cookiefile = cookie_file))
content(res)
download_url <- res_json[["files"]][["links"]][["download"]]
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
res <- GET(download_url, httr::config(cookiefile = cookie_file))
content(res)
readLines(cookie_file)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiefile=cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
readLines(cookie_file)
cookie_file <- tempfile("cookie", fileext = ".txt")
handle_setopt(h,cookiefile = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
readLines(cookie_file)
handle_cookies(h)
rm(h)
gc()
file.exist(cookie_file)
file.exists(cookie_file)
handle_cookies()
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiefile = cookie_file)
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
handle_cookies(h)
file.exists(cookie_file)
rm(h)
gc()
file.exists(cookie_file)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
res <- GET(download_url, httr::config(cookiejar = cookie_file))
content(res)
res <- GET(download_url, httr::config(cookiefile = cookie_file))
content(res)
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
res <- GET(download_url, httr::config(cookiefile = cookie_file))
download_url <- res_json[["files"]][["links"]][["download"]]
res <- GET(download_url, httr::config(cookiefile = cookie_file))
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
handle_cookies(h)
handle_cookies(h)
rm(h)
gc()
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
res <- GET(download_url, httr::config(cookiefile = cookie_file))
content(res)
h <- new_handle()
handle_setopt(h,cookiefile = cookie_file)
res <- GET(download_url, httr::config(cookiefile = cookie_file))
content(res)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_cookies(h)
rm(h)
gc()
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
h <- new_handle()
handle_setopt(h,cookiefile = cookie_file)
res <- GET(download_url, httr::config(cookiefile = cookie_file))
res <- GET(download_url, httr::config(cookiefile = cookie_file))
content(res)
res <- curl_fetch_memory(download_url,h)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, h)
curl_download(download_url, destfile = dest, handle = h)
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory(download_url, h)
content(res)
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
res <- GET(download_url, httr::config(cookiefile = cookie_file))
res <- GET(download_url, httr::config(cookiefile = cookie_file))
content(res)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
handle_setopt(h,cookie_file = cookie_file)
handle_setopt(h,cookiefile = cookie_file)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
curl_download(download_url,  h)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_cookies(h)
rm(h)
gc()
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
h <- new_handle()
handle_setopt(h,cookiefile = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
curl_fetch_memory(download_url,h)
handle_cookies(h)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_cookies(h)
rm(h)
handle_cookies(h)
readlines(cookie_file)
readline(cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
h <- new_handle()
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
handle_cookies(h)
handle_setopt(h,cookiejar = cookie_file)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_cookies(h)
rm(h)
gc()
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
readlines(cookie_file)
readLines(cookie_file)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_cookies(h)
handle_reset()
handle_reset(h)
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
handle_cookies(h)
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
handle_reset(h)
dest <- paste0(getwd(), "valentine.zip")
curl_fetch_memory(download_url,h)
curl_fetch_memory(download_url,h)
curl_download(download_url, destfile = dest, handle = h)
system("curl")
system("curl --cookie-jar", cookie_file)
system( paste0("curl --cookie-jar", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL"))
cookie_file <- tempfile("cookie", fileext = ".txt")
system( paste0("curl --cookie-jar", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL"))
system( paste0("curl --cookie-jar", cookie_file, " https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL"))
system( paste("curl --cookie-jar", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL"))
readLines(cookie_file)
cookie_file <- tempfile("cookie", fileext = ".txt")
t <- paste("curl --cookie-jar", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL"))
t <- paste("curl --cookie-jar", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL")
system(t)
cookie_file <- tempfile("cookie", fileext = ".txt")
t <- paste("curl --cookie-jar", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL")
system(t)
t <- paste("curl --cookie-jar", cookie_file, "'https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL'")
system(t)
echo(t)
print(t)
res <- curl_fetch_memory("https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
cookie_file <- tempfile("cookie", fileext = ".txt")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res <- curl_fetch_memory("https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
library("httr")
library("curl")
library("curl")
library("jsonlite")
cookie_file <- tempfile("cookie", fileext = ".txt")
system("curl --cookie-jar" )
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
url <- curl_fetch_memory("https://zenodo.org/record/4835981?xxxx")
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_cookies(h)
handle_reset(h)
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
readLines(cookie_file)
h <- new_handle()
handle_setopt(h,cookiefile = cookie_file)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_cookies(h)
handle_reset(h)
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
readlines(cookie_file)
readline(cookie_file)
library(dplyr)
readlines(cookie_file)
readLines(cookie_file)
library("httr")
library("curl")
library("jsonlite")
cookie_file <- tempfile("cookie", fileext = ".txt")
library("httr")
library("curl")
library("jsonlite")
system(paste("curl --cookie-jar ", cookie_file) )
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981") )
readLines(cookie_file)
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
curl_download(download_url, destfile = dest, handle = h)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
# Cookies created after cleanup, see https://github.com/r-lib/httr/issues/593
file.exists(cookie_file)
readLines(cookie_file)
handle_setopt(h,cookiefile = cookie_file)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
curl_download(download_url, destfile = dest, handle = h)
readLines(cookie_file)
readLines(cookie_file)
cookie_file <- tempfile("cookie", fileext = ".txt")
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
readLines(cookie_file)
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
handle_setopt(h,cookiefile = cookie_file)
dest <- paste0(getwd(), "valentine.zip")
curl_download(download_url, destfile = dest, handle = h)
install.packages("tidyverse")
install.packages("mapsf")
install.packages("sf")
library("httr")
library("jsonlite")
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
read(cookie_file)
readr(cookie_file)
readLines(cookie_file)
writeLines(text = "", con = cookie_file)
cookie_file <- tempfile("cookie", fileext = ".txt")
writeLines(text = "", con = cookie_file)
readLines(cookie_file)
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
readLines(cookie_file)
readLine(cookie_file)
h <- new_handle()
library("httr")
library("curl")
library("jsonlite")
h <- new_handle()
handle_setopt(h,cookiejar = cookie_file)
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
curl_download(download_url, destfile = dest, handle = h)
readLine(cookie_file)
readLines(cookie_file)
download_url
url <- curl_fetch_memory("https://zenodo.org/record/4835981")
res_json <- jsonlite::fromJSON(rawToChar(res$content))
download_url <- res_json[["files"]][["links"]][["download"]]
download_url
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
url <- curl_fetch_memory("https://zenodo.org/record/4835981")
res_json <- jsonlite::fromJSON(rawToChar(url$content))
res <- curl_fetch_memory("https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL", handle = h)
res_json <- jsonlite::fromJSON(rawToChar(res$content))
View(res_json)
res_json[["files"]][["links"]][["download"]]
res_json[["files"]][["links"]][["self"]]
system(paste("curl --cookie ", cookie_file, "download_url"))
system(paste("curl --cookie ", cookie_file, " ", download_url))
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
res <- system(paste("curl --cookie ", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981"))
res <- system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981"))
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
res <- system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981"))
res <- system(paste("curl --cookie ", cookie_file, "https://zenodo.org/api/deposit/depositions/4835981"))
res <- system(paste("curl  https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL"))
res_json <- jsonlite::fromJSON(rawToChar(res$content))
res_json <- jsonlite::fromJSON(rawToChar(res))
res_json <- jsonlite::fromJSON(rawToChar(res[1]))
red
res
res <- system(paste("curl  https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL > data.json"))
res_json <- read_json(paste("/tmp/RtmppxIGTw/","data.json"))
res <- system(paste("curl  https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL > /tmp/RtmppxIGTw/data.json"))
res_json <- read_json(paste("/tmp/RtmppxIGTw/","data.json"))
res_json <- read_json(paste("/tmp/RtmppxIGTw/","data.json"))
res_json <- read_json(paste0("/tmp/RtmppxIGTw/","data.json"))
download_url <- res_json[["files"]][["links"]][["download"]]
download_url
View(res_json)
View(res_json)
download_url <- res_json[["links"]][["download"]]
download_url <- res_json[["files["]][["1"]][["links"]][["download"]]
res_json[["files"]]
res_json[["files"]][[1]]
res_json[["files"]][[1]][["links"]]
res_json[["files"]][[1]][["links"]]$download
download_url <- res_json[["files["]][["1"]][["links"]]$"download"
download_url <- res_json[["files["]][[1]][["links"]]$"download"
download_url <- res_json[["files"]][[1]][["links"]]$"download"
system(paste("curl --cookie ", cookie_file, " ", download_url))
system(paste("curl --cookie ", cookie_file, " ", download_url "?access_token=UAPhIVpjONxBvkf84"))
system(paste("curl --cookie ", cookie_file, " ", download_url , "?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhl"))
system(paste0("curl --cookie ", cookie_file, " ", download_url , "?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhl"))
system(paste0("curl ", download_url , "?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhl"))
library("httr")
library("curl")
library("jsonlite")
system(paste("curl --cookie-jar ", cookie_file, "https://zenodo.org/record/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL") )
res <- system(paste("curl  https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL > /tmp/RtmppxIGTw/data.json"))
cookie_file <- tempfile("cookie", fileext = ".txt")
writeLines(text = "", con = cookie_file)
res <- system(paste("curl  https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL > /tmp/RtmpOhiypU/data.json"))
res <- system(paste("curl  https://zenodo.org/api/deposit/depositions/4835981?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhL > /tmp/RtmpOhIypU/data.json"))
res_json <- read_json(paste0("/tmp/RtmpOhIypU/","data.json"))
download_url <- res_json[["files"]][[1]][["links"]]$"download"
system(paste0("curl ", download_url , "?access_token=UAPhIVpjONxBvkf84jrBqtmm2elgZrAcAVH4NopS0DS4loM0bJGgE4LXIhhl"))
download_url
